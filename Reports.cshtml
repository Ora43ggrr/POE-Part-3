@{
    ViewData["Title"] = "Reports";
}

<div class="container">
    <h2 class="text-blue mb-4">Reports Dashboard</h2>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card dashboard-widget">
                <div class="card-body text-center">
                    <h5 class="card-title">Total Claims</h5>
                    <h2 class="text-blue">@ViewBag.TotalClaims</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card dashboard-widget">
                <div class="card-body text-center">
                    <h5 class="card-title">Pending Claims</h5>
                    <h2 class="text-blue">@ViewBag.TotalPendingClaims</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card dashboard-widget">
                <div class="card-body text-center">
                    <h5 class="card-title">Approved Claims</h5>
                    <h2 class="text-blue">@ViewBag.ApprovedForPayment</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card dashboard-widget">
                <div class="card-body text-center">
                    <h5 class="card-title">Your Role</h5>
                    <h2 class="text-blue">@ViewBag.UserRole</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Generation -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">Generate Custom Report</h5>
        </div>
        <div class="card-body">
            <form method="post" asp-action="GenerateReport">
                <div class="row">
                    <div class="col-md-4">
                        <label for="month" class="form-label">Month</label>
                        <select class="form-select" id="month" name="month">
                            @for (int i = 1; i <= 12; i++)
                            {
                                <option value="@i" selected="@(i == DateTime.Now.Month)">@System.Globalization.DateTimeFormatInfo.CurrentInfo.GetMonthName(i)</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="year" class="form-label">Year</label>
                        <input type="number" class="form-control" id="year" name="year" value="@DateTime.Now.Year" min="2020" max="2030" />
                    </div>
                    <div class="col-md-4">
                        <label for="reportType" class="form-label">Report Type</label>
                        <select class="form-select" id="reportType" name="reportType">
                            <option value="Summary">Summary Report</option>
                            <option value="Detailed">Detailed Report</option>
                            <option value="Financial">Financial Report</option>
                        </select>
                    </div>
                </div>
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary">Generate Report</button>
                    <a href="@Url.Action("Dashboard","Home")" class="btn btn-outline-secondary">Back to Dashboard</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Sample Report Data -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">System Overview</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Count</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Total Claims</td>
                            <td>@ViewBag.TotalClaims</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Pending Approval</td>
                            <td>@ViewBag.TotalPendingClaims</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>Approved (Ready for Payment)</td>
                            <td>@ViewBag.ApprovedForPayment</td>
                            <td>R @(_dataService.Claims.Where(c => c.Status == "Approved" && c.PaymentDate == null).Sum(c => c.TotalAmount).ToString("N2"))</td>
                        </tr>
                        <tr>
                            <td>Paid Claims</td>
                            <td>@(_dataService.Claims.Count(c => c.Status == "Paid"))</td>
                            <td>R @(_dataService.Claims.Where(c => c.Status == "Paid").Sum(c => c.TotalAmount).ToString("N2"))</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@inject POE_Part_3.Services.DataService _dataService